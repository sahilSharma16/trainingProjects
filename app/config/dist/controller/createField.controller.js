sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/m/MessageBox"],function(e,t,o,i,a,s,l){"use strict";var n;var d;var r;return e.extend("app.config.controller.createField",{onInit:function(){},usedNameAndDesc:function(){var e=this;var t=new Promise(function(t,o){var i=new sap.ui.model.json.JSONModel;e.getView().setModel(i,"usedFieldDataModel");let a=e.getOwnerComponent().getModel();let s=a.bindList("/fieldTable");s.requestContexts(0,Infinity).then(function(o){r=[];o.forEach(function(e){r.push(e.getObject())});i.setData(r);var a=e.getView().getModel("usedFieldDataModel").getData();d=a.map(function(e){return{id:e.id,fieldName:e.fieldName,fieldDesc:e.fieldDesc}});console.log("Validate New Parameter",d);t(r)})})},onCreateField:function(){this.usedNameAndDesc();var e=this.getView();const o={fieldName:"",fieldDesc:""};const i=new t(o);e.setModel(i,"addFieldModel");if(!this._oDialogItem){this._oDialogItem=sap.ui.xmlfragment("app.config.fragments.addField",this);e.addDependent(this._oDialogItem)}this._oDialogItem.open()},oncancelNewField:function(){this._oDialogItem.close()},RefreshData:function(){this.getView().byId("fieldTable").getBinding("items").refresh()},onsaveNewField:async function(){var e=this.getView().getModel("addFieldModel").getData();await this.onLastFieldID();var t={id:parseInt(n,10),fieldName:e.fieldName,fieldDesc:e.fieldDesc};if(t.fieldName===""||t.fieldDesc===""){sap.m.MessageToast.show("Input fields cannot be blank.",{duration:3e3,width:"15em",my:"center top",at:"center top",of:window,offset:"30 30",onClose:function(){console.log("Message toast closed")}});console.log("Field or description cannot be null");return}else{var o=d.some(function(e){return e.fieldName===t.fieldName||e.fieldDesc===t.fieldDesc});if(o){sap.m.MessageToast.show("Field or Description already exists.",{duration:3e3,width:"15em",my:"center top",at:"center top",of:window,offset:"30 30",onClose:function(){console.log("Message toast closed")}});console.log("Duplicate found");return}else{d.push(t);console.log("Entry added successfully")}}console.log(t);let i=this.getView().getModel();let a=i.bindList("/fieldTable");a.create(t);this._oDialogItem.close();this.RefreshData()},onLastFieldID:function(){try{var e=this.getView().byId("fieldTable");var t=e.getItems();var o=new Set;t.forEach(function(e){var t=parseInt(e.getCells()[0].getText(),10);if(!isNaN(t)){o.add(t)}});for(let e=1;e<=t.length+1;e++){if(!o.has(e)){n=e;break}}}catch(e){n="1"}console.log("Next Available ID:",n)}})});